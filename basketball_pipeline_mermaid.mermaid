flowchart TD
    %% Input
    A[ğŸ“¹ Video Frame Input<br/>BGR Format] --> B{ğŸ¯ YOLO Detection}
    
    %% YOLO Detection Phase
    B --> C[ğŸ“Š Raw Detections<br/>- Bounding boxes<br/>- Confidence scores<br/>- Player areas]
    
    %% Detection Smoothing Phase
    C --> D[ğŸ”„ Detection Smoother<br/>History-based filtering]
    D --> E{ğŸ“ˆ Smoothing Process}
    E --> F[âœ… Smoothed Detections<br/>- Confidence smoothing<br/>- Persistence check<br/>- Position smoothing]
    
    %% Segmentation Phase
    F --> G{ğŸ–¼ï¸ SAM2 Segmentation<br/>Available?}
    G -->|Yes| H[ğŸ­ SAM2 Segmenter<br/>- Pixel-perfect masks<br/>- Stability scores<br/>- Region filtering]
    G -->|No| I[ğŸ“¦ Fallback Masks<br/>Rectangular masks]
    
    H --> J[âœ¨ Segmented Detections<br/>With pixel masks]
    I --> J
    
    %% Tracking Phase
    J --> K[ğŸƒ ByteTrack Tracker<br/>Motion-based tracking]
    K --> L{ğŸ”„ Track Update Process}
    L --> M[ğŸ‘¥ Tracked Players<br/>With unique IDs]
    
    %% Enhancement Phase
    M --> N[ğŸ”§ Track Enhancement<br/>Match with segmentation]
    N --> O[â­ Enhanced Tracks<br/>- Track IDs<br/>- Masks<br/>- Confidence scores]
    
    %% Visualization Phase
    O --> P{ğŸ¨ Visualization Mode}
    P -->|Mask Only| Q[ğŸ‘» Mask-only Visualization<br/>- Colored masks<br/>- Track ID labels<br/>- Contours]
    P -->|Full| R[ğŸ¯ Full Visualization<br/>- Bounding boxes<br/>- Masks overlay<br/>- Labels & confidence]
    
    Q --> S[ğŸ“º Final Output Frame]
    R --> S
    
    %% Statistics and Performance
    S --> T[ğŸ“Š Statistics Update<br/>- Frame count<br/>- Detection counts<br/>- Performance metrics]
    
    %% Styling
    style A fill:#e1f5fe
    style S fill:#e8f5e8
    style T fill:#fff3e0